<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pedidos - Melhor Bocado</title>

    <!-- SDK do Zoho Creator v2 -->
    <script src="https://js.zohostatic.com/creator/widgets/version/2.0/widgetsdk-min.js"></script>

    <!-- Estilos -->
    <link rel="stylesheet" href="css/widget.css" />
  </head>
  <body>
    <!-- Alert/Status Global -->
    <div id="status" class="alert-box loading visible">
      <div class="alert-icon">
        <div class="spinner-brand"></div>
      </div>
      <div class="alert-text">
        <span class="alert-title">Aguarde</span>
        <span class="alert-message">Conectando ao sistema...</span>
      </div>
    </div>

    <!-- Loading de Transição (Carregando detalhes do cliente) -->
    <div id="loading-overlay" class="loading-overlay hidden">
      <div class="loading-content">
        <div class="loading-spinner"></div>
        <h3>Carregando dados do cliente</h3>
        <p>Aguarde enquanto buscamos as informações...</p>
      </div>
    </div>

    <!-- ========================================
         ETAPA 1: SELEÇÃO DE CLIENTE 
         ======================================== -->
    <div id="step-cliente" class="step-cliente-wrapper">
      <div class="selection-card">
        <!-- Header com Branding -->
        <div class="card-branding">
          <img
            src="https://melhorbocado.com.br/wp-content/uploads/2023/12/logo.png"
            alt="Melhor Bocado"
            class="card-branding-logo"
          />
          <h1>Novo Pedido</h1>
          <p>Selecione o cliente para iniciar</p>
        </div>

        <!-- Corpo do Card -->
        <div class="card-body">
          <div class="card-body-header">
            <h2>Buscar Cliente</h2>
            <p>Digite o nome, razão social ou CNPJ</p>
          </div>

          <!-- Campo de Busca -->
          <div class="search-container">
            <svg
              class="search-icon"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <circle cx="11" cy="11" r="8"></circle>
              <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
            </svg>
            <input
              type="text"
              id="search-cliente"
              class="search-input"
              placeholder="Digite para buscar..."
              autocomplete="off"
            />
          </div>

          <!-- Lista de Clientes -->
          <div id="client-list" class="client-list">
            <div class="empty-state">
              <svg
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="1.5"
              >
                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                <circle cx="9" cy="7" r="4"></circle>
                <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
              </svg>
              <p>Digite para buscar clientes</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ========================================
         ETAPA 2: CRIAÇÃO DO PEDIDO
         ======================================== -->
    <div id="step-pedido" class="step-pedido-wrapper hidden">
      <!-- Header do Pedido -->
      <header class="app-header">
        <img
          src="https://melhorbocado.com.br/wp-content/uploads/2023/12/logo.png"
          alt="Melhor Bocado"
          class="header-logo"
        />
        <div class="header-text">
          <h1>Novo Pedido</h1>
          <p id="header-subtitle">Configure os detalhes do pedido</p>
        </div>

        <!-- Vendedor -->
        <div class="header-vendedor">
          <svg
            width="18"
            height="18"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
            <circle cx="12" cy="7" r="4"></circle>
          </svg>
          <div class="vendedor-info">
            <span class="vendedor-label">Vendedor</span>
            <span class="vendedor-nome" id="vendedor-nome">-</span>
          </div>
        </div>

        <!-- Botão Debug -->
        <button
          type="button"
          class="btn-debug"
          onclick="WidgetUI.toggleDebug()"
          title="Abrir Debug"
        >
          <svg
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <path d="M12 19l7-7 3 3-7 7-3-3z"></path>
            <path d="M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"></path>
            <path d="M2 2l7.586 7.586"></path>
            <circle cx="11" cy="11" r="2"></circle>
          </svg>
        </button>
      </header>

      <div class="pedido-layout">
        <!-- Sidebar: Dados do Cliente -->
        <aside class="cliente-sidebar">
          <div class="sidebar-header">
            <h3>Pedido</h3>
            <button
              type="button"
              class="btn-trocar"
              onclick="WidgetApp.voltarParaCliente()"
              title="Trocar cliente"
            >
              <svg
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <path d="M1 4v6h6"></path>
                <path d="M23 20v-6h-6"></path>
                <path d="M20.49 9A9 9 0 0 0 5.64 5.64L1 10"></path>
                <path d="M3.51 15a9 9 0 0 0 14.85 3.36L23 14"></path>
              </svg>
              Trocar
            </button>
          </div>

          <div class="cliente-dados">
            <div class="cliente-avatar-lg" id="cliente-avatar-lg">MB</div>

            <div class="cliente-info-group">
              <label>Razão Social</label>
              <p id="cliente-razao">-</p>
            </div>

            <div class="cliente-info-group">
              <label>Nome Fantasia</label>
              <p id="cliente-fantasia">-</p>
            </div>

            <div class="cliente-info-group">
              <label>CNPJ/CPF</label>
              <p id="cliente-documento">-</p>
            </div>
          </div>
        </aside>

        <!-- Área Principal com Tabs -->
        <main class="pedido-main">
          <!-- Tabs Navigation -->
          <div class="tabs-nav">
            <button
              type="button"
              class="tab-btn active"
              data-tab="config"
              onclick="WidgetUI.switchTab('config')"
            >
              <svg
                width="18"
                height="18"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <circle cx="12" cy="12" r="3"></circle>
                <path
                  d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"
                ></path>
              </svg>
              Configurações
            </button>
            <button
              type="button"
              class="tab-btn"
              data-tab="produtos"
              onclick="WidgetUI.switchTab('produtos')"
            >
              <svg
                width="18"
                height="18"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <path
                  d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"
                ></path>
                <line x1="3" y1="6" x2="21" y2="6"></line>
                <path d="M16 10a4 4 0 0 1-8 0"></path>
              </svg>
              Produtos
            </button>
          </div>

          <!-- Tab: Configurações -->
          <div id="tab-config" class="tab-content active">
            <div class="config-grid">
              <!-- Seção de Endereço de Entrega (Expansível) -->
              <div
                id="endereco-section"
                class="form-section full-width collapsed"
              >
                <div
                  class="section-header section-header-clickable"
                  onclick="WidgetUI.toggleEndereco()"
                >
                  <div class="section-icon">
                    <svg
                      width="20"
                      height="20"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                    >
                      <path
                        d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"
                      ></path>
                      <circle cx="12" cy="10" r="3"></circle>
                    </svg>
                  </div>
                  <div class="section-title">
                    <h4>Endereço de Entrega</h4>
                    <p>Clique para ver os detalhes do endereço</p>
                  </div>
                  <div class="section-toggle">
                    <svg
                      id="endereco-toggle-icon"
                      width="20"
                      height="20"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      class="toggle-icon"
                    >
                      <polyline points="6 9 12 15 18 9"></polyline>
                    </svg>
                  </div>
                </div>

                <!-- Endereço Resumido (visível quando colapsado) -->
                <div
                  id="endereco-resumo-container"
                  class="endereco-resumo-container"
                >
                  <input
                    type="text"
                    id="endereco-resumo"
                    class="form-input endereco-resumo-input"
                    readonly
                    placeholder="Endereço será carregado automaticamente..."
                  />
                </div>

                <!-- Grid de Detalhes (oculto quando colapsado) -->
                <div
                  id="endereco-detail-grid"
                  class="address-grid"
                  style="display: none"
                >
                  <!-- Logradouro -->
                  <div class="form-group address-street">
                    <label for="endereco-logradouro">Logradouro</label>
                    <input
                      type="text"
                      id="endereco-logradouro"
                      class="form-input"
                      readonly
                      placeholder="Rua, Avenida..."
                    />
                  </div>

                  <!-- Bairro -->
                  <div class="form-group address-neighborhood">
                    <label for="endereco-bairro">Bairro</label>
                    <input
                      type="text"
                      id="endereco-bairro"
                      class="form-input"
                      readonly
                      placeholder="Bairro"
                    />
                  </div>

                  <!-- Município -->
                  <div class="form-group address-city">
                    <label for="endereco-municipio">Município</label>
                    <input
                      type="text"
                      id="endereco-municipio"
                      class="form-input"
                      readonly
                      placeholder="Cidade"
                    />
                  </div>

                  <!-- Estado -->
                  <div class="form-group address-state">
                    <label for="endereco-estado">UF</label>
                    <input
                      type="text"
                      id="endereco-estado"
                      class="form-input"
                      readonly
                      placeholder="UF"
                    />
                  </div>

                  <!-- CEP -->
                  <div class="form-group address-zip">
                    <label for="endereco-cep">CEP</label>
                    <input
                      type="text"
                      id="endereco-cep"
                      class="form-input"
                      readonly
                      placeholder="00000-000"
                    />
                  </div>

                  <!-- Complemento -->
                  <div class="form-group address-complement">
                    <label for="endereco-complemento">Complemento</label>
                    <input
                      type="text"
                      id="endereco-complemento"
                      class="form-input"
                      readonly
                      placeholder="Apto, Sala, Bloco..."
                    />
                  </div>
                </div>

                <!-- Campo oculto para endereço resumido (compatibilidade) -->
                <input type="hidden" id="endereco-entrega" />
              </div>

              <!-- Condição de Pagamento (Select Customizado) -->
              <div class="form-group">
                <label>Condição de Pagamento</label>
                <div
                  class="custom-select-wrapper"
                  onclick="WidgetUI.toggleSelect(this)"
                >
                  <div class="custom-select-trigger">
                    <span class="selected-value">Selecione...</span>
                    <svg
                      class="custom-select-arrow"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                    >
                      <polyline points="6 9 12 15 18 9"></polyline>
                    </svg>
                  </div>
                  <div class="custom-options">
                    <div
                      class="custom-option"
                      style="
                        pointer-events: none;
                        color: var(--color-text-muted);
                      "
                    >
                      Carregando...
                    </div>
                  </div>
                  <input
                    type="hidden"
                    id="condicao-pagamento"
                    name="condicao-pagamento"
                  />
                </div>
              </div>

              <div class="form-group">
                <label>Tipo de Frete</label>
                <div class="option-cards">
                  <div
                    class="option-card active"
                    data-value="cif"
                    data-group="frete"
                    onclick="WidgetUI.selectOption(this)"
                  >
                    <div class="option-card-icon">
                      <svg
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                      >
                        <rect x="1" y="3" width="15" height="13"></rect>
                        <polygon
                          points="16 8 20 8 23 11 23 16 16 16 16 8"
                        ></polygon>
                        <circle cx="5.5" cy="18.5" r="2.5"></circle>
                        <circle cx="18.5" cy="18.5" r="2.5"></circle>
                      </svg>
                    </div>
                    <span class="option-card-label">CIF</span>
                  </div>
                  <div
                    class="option-card"
                    data-value="fob"
                    data-group="frete"
                    onclick="WidgetUI.selectOption(this)"
                  >
                    <div class="option-card-icon">
                      <svg
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                      >
                        <path
                          d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"
                        ></path>
                        <polyline
                          points="3.27 6.96 12 12.01 20.73 6.96"
                        ></polyline>
                        <line x1="12" y1="22.08" x2="12" y2="12"></line>
                      </svg>
                    </div>
                    <span class="option-card-label">FOB</span>
                  </div>
                </div>
              </div>

              <!-- Natureza do Pedido (Cards) -->
              <div class="form-group">
                <label>Natureza</label>
                <div class="option-cards">
                  <div
                    class="option-card active"
                    data-value="venda"
                    data-group="natureza"
                    onclick="WidgetUI.selectOption(this)"
                  >
                    <div class="option-card-icon">
                      <svg
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                      >
                        <circle cx="9" cy="21" r="1"></circle>
                        <circle cx="20" cy="21" r="1"></circle>
                        <path
                          d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"
                        ></path>
                      </svg>
                    </div>
                    <span class="option-card-label">Venda</span>
                  </div>
                  <div
                    class="option-card"
                    data-value="bonificacao"
                    data-group="natureza"
                    onclick="WidgetUI.selectOption(this)"
                  >
                    <div class="option-card-icon">
                      <svg
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                      >
                        <path d="M20 12v10H4V12"></path>
                        <path d="M2 7h20v5H2z"></path>
                        <path d="M12 22V7"></path>
                        <path
                          d="M12 7H7.5a2.5 2.5 0 0 1 0-5C11 2 12 7 12 7z"
                        ></path>
                        <path
                          d="M12 7h4.5a2.5 2.5 0 0 0 0-5C13 2 12 7 12 7z"
                        ></path>
                      </svg>
                    </div>
                    <span class="option-card-label">Bonificação</span>
                  </div>
                </div>
              </div>

              <!-- Nº Pedido Cliente (Input Simples) -->
              <div class="form-group">
                <label for="numero-pedido-cliente">Nº Pedido Cliente</label>
                <input
                  type="text"
                  id="numero-pedido-cliente"
                  class="form-input"
                  placeholder="Informe o número do pedido (opcional)"
                />
              </div>

              <!-- Observações -->
              <div class="form-group full-width">
                <label for="observacoes">Observações</label>
                <textarea
                  id="observacoes"
                  class="form-textarea"
                  rows="2"
                  placeholder="Observações adicionais (opcional)"
                ></textarea>
              </div>
            </div>
          </div>

          <!-- Tab: Produtos -->
          <div id="tab-produtos" class="tab-content">
            <div class="pedido-placeholder">
              <svg
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="1.5"
              >
                <path
                  d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"
                ></path>
                <line x1="3" y1="6" x2="21" y2="6"></line>
                <path d="M16 10a4 4 0 0 1-8 0"></path>
              </svg>
              <p>Área de produtos do pedido</p>
              <span class="hint">(Próxima etapa de desenvolvimento)</span>
            </div>
          </div>
        </main>
      </div>

      <!-- Footer com ações -->
      <footer class="pedido-footer">
        <div class="footer-info">
          <span class="total-label">Total do Pedido:</span>
          <span class="total-valor">R$ 0,00</span>
        </div>
        <div class="footer-actions">
          <button
            type="button"
            class="btn btn-secondary btn-cancel"
            onclick="WidgetApp.confirmarCancelamento()"
          >
            Cancelar
          </button>
          <button
            type="button"
            id="btn-voltar"
            class="btn btn-outline hidden"
            onclick="WidgetApp.voltarAba()"
          >
            <svg
              width="18"
              height="18"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <polyline points="15 18 9 12 15 6"></polyline>
            </svg>
            Voltar
          </button>
          <button
            type="button"
            id="btn-footer-action"
            class="btn btn-primary"
            onclick="WidgetApp.footerAction()"
          >
            <svg
              id="btn-footer-icon"
              width="18"
              height="18"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <polyline points="9 18 15 12 9 6"></polyline>
            </svg>
            <span id="btn-footer-text">Avançar</span>
          </button>
        </div>
      </footer>
    </div>

    <!-- Modal de Confirmação de Cancelamento -->
    <div id="modal-cancelar" class="modal-overlay hidden">
      <div class="modal-dialog">
        <div class="modal-icon">
          <svg
            width="48"
            height="48"
            viewBox="0 0 24 24"
            fill="none"
            stroke="#e91e63"
            stroke-width="2"
          >
            <circle cx="12" cy="12" r="10"></circle>
            <line x1="12" y1="8" x2="12" y2="12"></line>
            <line x1="12" y1="16" x2="12.01" y2="16"></line>
          </svg>
        </div>
        <h3>Cancelar Pedido?</h3>
        <p>
          Tem certeza que deseja cancelar? Todos os dados preenchidos serão
          perdidos.
        </p>
        <div class="modal-actions">
          <button
            type="button"
            class="btn btn-secondary"
            onclick="WidgetUI.fecharModal('modal-cancelar')"
          >
            Não, Continuar
          </button>
          <button
            type="button"
            class="btn btn-danger"
            onclick="WidgetApp.voltarParaCliente()"
          >
            Sim, Cancelar
          </button>
        </div>
      </div>
    </div>

    <!-- Debug Log (Oculto por padrão) -->
    <div id="debug-panel" class="debug-panel hidden">
      <div class="debug-header">
        <strong>Debug Log</strong>
        <button
          type="button"
          class="btn-close-debug"
          onclick="WidgetUI.toggleDebug()"
        >
          ×
        </button>
      </div>
      <div id="debug" class="debug-content"></div>
    </div>

    <!-- Scripts -->
    <script src="js/config.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/api.js"></script>
    <script src="js/app.js"></script>
  </body>
</html>
